{"version":3,"file":"ractive-autocomplete.js","sources":["../src/index.js"],"sourcesContent":["/* global Ractive */\n\nvar template = `<div class=\"ractive-autocomplete\"><input value=\"{{text}}\" on-blur=\"blurred()\" on-dblclick=\"popup()\" on-keydown=\"keydown\" {{#if .placeholder}}placeholder=\"{{.placeholder}}\"{{/if}} /><div on-click=\"clicked\">\n{{#popup}}\n<ul>{{#completions:i}}<li {{#isCurrent(i)}}class=\"current\"{{/}}>{{display(.)}}</li>{{/}}</ul>\n{{/}}</div></div>`;\n\nfunction isCurrent(idx) { return this.get('current') === idx; }\nfunction display(member) {\n  return this.display(member);\n}\n\nexport default Ractive.extend({\n  template: template,\n  lazy: 500,\n  isolated: true,\n  oninit() {\n    this.observe('text', (cur, prev) => {\n      // only do completion lookup if this is not from a `select`\n      if (cur !== this.get('currentText')) {\n        // reset current index\n        this.set('current', -1);\n\n        // get new completions\n        var fn = this.get('complete');\n        if (fn && typeof fn === 'function') {\n          var res = fn(cur);\n          if (Object.prototype.toString.call(res) === '[object Array]') {\n            this.set('completions', res);\n            this.popup();\n          }\n          else if (res.then && typeof res.then === 'function') res.then(arr => {\n            this.set('completions', arr);\n            this.popup();\n          });\n        }\n      }\n    }, { init: false });\n  },\n  onrender() {\n    var cpl, val;\n\n    this.on('clicked', (e) => {\n      var i, child, ul = this.find('ul'), found = -1;\n      for (i = 0; i < ul.children.length && (child = ul.children[i]); i++) {\n        if (child === e.original.target) {\n          found = i;\n          break;\n        }\n      }\n      this.select(found);\n    });\n\n    this.on('keydown', (e) => {\n      var k = e.original.keyCode;\n      if (k === 27) {\n        this.closePopup();\n      } else if (k === 38 || k === 40) {\n        e.original.preventDefault();\n        if (!this.get('popup')) return this.popup();\n        var c = this.get('current');\n        this.select(k === 38 ? c - 1 : c + 1, false);\n      } else if (k === 13) {\n        e.original.preventDefault();\n        this.closePopup();\n        this.select(this.get('current'));\n      }\n    });\n\n    if ((cpl = this.get('completeWith')) && typeof cpl === 'function') {\n      this.completeWith(cpl);\n    }\n\n    // if there are no completions but there is a value, use it and select it\n    if (!!(cpl = this.get('completions')) && (val = this.get('value'))) {\n      this.set('completions', [val]);\n      this.select(0, false);\n    }\n  },\n  data() {\n    return {\n      isCurrent,\n      display,\n      completions: [],\n      current: -2,\n      popup: false,\n      currentText: '',\n      currentVal: '',\n      text: ''\n    };\n  },\n  blurred() {\n    if (this.blurTime) {\n      clearTimeout(this.blurTime);\n    }\n\n    this.blurTime = setTimeout(() => this.closePopup(), 200);\n  },\n  closePopup() { this.set('popup', false); },\n  popup() { this.set('popup', true); },\n  display(member) {\n    var name = this.get('displayMember');\n    if (typeof name === 'string') {\n      return member ? member[name] : '';\n    } else if (typeof name === 'function') {\n      return member ? name(member) : '';\n    } else {\n      return member ? member : '';\n    }\n  },\n  select(idx, fin = true) {\n    var val = this.get('completions') || [];\n    var text = '';\n\n    if (idx === -1) idx = val.length - 1;\n    else if (idx === val.length) idx = 0;\n\n    if (val) val = val[idx];\n    text = this.display(val);\n\n    // update current selections\n    this.set({\n      currentText: text,\n      currentVal: val\n    });\n\n    // update input and highlight\n    this.set({\n      text: text,\n      current: idx\n    });\n\n    if (fin) {\n      this.closePopup();\n      this.set('value', val);\n      this.fire('complete', text, idx, val);\n    }\n  },\n  completeWith(fn) {\n    this.set('complete', fn);\n    this.updateModel('text');\n  }\n});\n"],"names":[],"mappings":"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"}